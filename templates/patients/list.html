{% extends "base.html" %}
{% from 'macros/_cards.html' import patient_card, empty_state %}
{% from 'macros/_modals.html' import dashboard_modals %}

{% block title %}Pacientes - Terapia{% endblock %}

{% block extra_css %}
<style>
    /* MLC-inspired layered design for patients dashboard */
    
    /* Carousel indicators at bottom - no arrows */
    .carousel-indicators-bottom.single-slide button {
        opacity: 0.3;
        pointer-events: none;
    }
    
    /* Patient card hover effect */
    .patient-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .patient-card:hover {
        transform: translateY(-3px);
    }
    
    /* Session card styling */
    .session-card {
        border-radius: var(--radius-md);
    }
    
    /* Dashboard header styling */
    .dashboard-header {
        margin-bottom: 1.5rem;
    }
    .dashboard-header h1 {
        font-weight: var(--font-weight-medium);
        margin-bottom: 0.5rem;
    }
    .dashboard-header p {
        color: var(--text-muted);
        margin: 0;
    }
</style>
{% endblock extra_css %}

{% block main %}
    <div class="dashboard-header fade-in">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h1 class="h2 mb-1">
                    <i class="bi bi-people me-2 text-mlc-teal" aria-hidden="true"></i>
                    Pacientes
                </h1>
                <p class="text-body-secondary mb-0">Gestiona tus pacientes y sesiones de terapia</p>
            </div>
        </div>
    </div>
    
    <div class="patients-container">
        <!-- Filters -->
        <div class="btn-group mb-3" role="group" aria-label="Filtros de sesiones">
            {% for label, filter in filters %}
                <button type="button" 
                        class="btn btn-sm btn-outline-secondary filter-btn {% if show == filter or (not show and loop.index == 1) %}active{% endif %}" 
                        data-filter="{{ filter }}"
                        aria-pressed="{{ 'true' if show == filter or (not show and loop.index == 1) else 'false' }}"
                        onclick="applyFilter('{{ filter }}')">
                    <strong>{{ label|upper }}</strong>
                </button>
            {% endfor %}
        </div>

        <div class="patients-grid-container">
        {% if grouped_sessions %}
            <!-- Grid layout: max 3 patients per row -->
            <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
            {% for person, sessions in grouped_sessions.items() %}
                {{ patient_card(person[0], person[1], sessions, allow_delete, loop.index0 * 0.05) }}
            {% endfor %}
            </div>
        {% else %}
            {{ empty_state(
                icon='people',
                title='No hay pacientes',
                message='Comienza agregando tu primer paciente.',
                action_url=url_for('patients.add_person'),
                action_text='Agregar Paciente',
                action_icon='person-plus'
            ) }}
        {% endif %}
        </div>
    </div>

    <!-- Include all dashboard modals -->
    {{ dashboard_modals() }}
{% endblock main %}

{% block extra_js %}
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock extra_js %}
